{% extends 'base.html' %}
{% load static %}

{% block title %}{{ profile_user.get_full_name_or_username }} | INTERIOR{% endblock %}

{% block content %}
<div class="container" style="padding-top: 100px; padding-bottom: 60px;">
    <!-- Хлебные крошки -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb breadcrumb-visible py-2 px-3 rounded" style="background: rgba(212, 175, 55, 0.1);">
            <li class="breadcrumb-item"><a href="{% url 'home' %}" class="breadcrumb-link fw-medium">Главная</a></li>
            <li class="breadcrumb-item active fw-bold gold-text">Профиль пользователя</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Removed glass-card class to avoid JS opacity animation issue, using card only -->
            <div class="card" style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg);">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            {% if profile_user.avatar %}
                            <img src="{{ profile_user.avatar.url }}" alt="{{ profile_user.username }}"
                                 class="rounded-circle"
                                 style="width: 120px; height: 120px; object-fit: cover; border: 3px solid var(--color-gold);">
                            {% else %}
                            <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto"
                                 style="width: 120px; height: 120px; background: var(--bg-secondary); border: 3px solid var(--color-gold);">
                                <i class="fas fa-user fa-3x" style="color: var(--text-muted);"></i>
                            </div>
                            {% endif %}
                        </div>
                        <!-- Fixed text colors using inline styles instead of themed classes -->
                        <h4 class="fw-bold mb-1" style="color: var(--text-primary);">{{ profile_user.get_full_name_or_username }}</h4>
                        <p class="mb-3" style="color: var(--text-muted);">@{{ profile_user.username }}</p>

                        <div class="d-flex justify-content-center gap-2 flex-wrap">
                            <span class="badge px-3 py-2" style="background: rgba(212, 175, 55, 0.2); color: var(--color-gold);">
                                <i class="fas fa-user me-1"></i>{{ profile_user.get_user_type_display }}
                            </span>
                            {% if profile_user.email_verified %}
                            <span class="badge px-3 py-2" style="background: rgba(34, 197, 94, 0.2); color: #4ade80;">
                                <i class="fas fa-check-circle me-1"></i>Подтверждён
                            </span>
                            {% endif %}
                            <!-- Отображение статуса блокировки в публичном профиле -->
                            {% if profile_user.is_blocked %}
                            <span class="badge px-3 py-2" style="background: rgba(239, 68, 68, 0.2); color: #f87171;">
                                <i class="fas fa-ban me-1"></i>Заблокирован
                            </span>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Блок с информацией о блокировке для публичного профиля -->
                    {% if profile_user.is_blocked %}
                    <div class="mb-4 p-3 rounded" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <h6 class="fw-bold mb-2" style="color: #f87171;">
                            <i class="fas fa-ban me-2"></i>Аккаунт заблокирован
                        </h6>
                        {% if profile_user.block_reason %}
                        <p class="mb-1" style="color: var(--text-secondary);">
                            <strong>Причина:</strong> {{ profile_user.block_reason }}
                        </p>
                        {% endif %}
                        {% if profile_user.blocked_at %}
                        <small style="color: var(--text-muted);">
                            <i class="fas fa-calendar-times me-1"></i>
                            Заблокирован: {{ profile_user.blocked_at|date:"d.m.Y" }}
                        </small>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Статистика -->
                    <div class="row text-center mb-4">
                        <div class="col-12">
                            <div class="p-3 rounded" style="background: rgba(212, 175, 55, 0.1);">
                                <div class="h3 mb-0 fw-bold gold-text">{{ user_stats.reviews_count }}</div>
                                <small style="color: var(--text-muted);">Отзывов</small>
                            </div>
                        </div>
                    </div>

                    <!-- VK link -->
                    {% if profile_user.social_vk %}
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3 gold-text">
                            <i class="fab fa-vk me-2"></i>ВКонтакте
                        </h6>
                        <a href="{{ profile_user.social_vk }}" target="_blank" rel="noopener noreferrer"
                           class="text-decoration-none" style="color: var(--text-secondary);">
                            <i class="fas fa-external-link-alt me-1"></i>{{ profile_user.social_vk }}
                        </a>
                    </div>
                    {% endif %}

                    {% if profile_user.bio %}
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3 gold-text">
                            <i class="fas fa-quote-left me-2"></i>О себе
                        </h6>
                        <p class="mb-0" style="color: var(--text-secondary);">{{ profile_user.bio }}</p>
                    </div>
                    {% endif %}

                    <div class="mb-4">
                        <small style="color: var(--text-muted);">
                            <i class="fas fa-calendar me-1"></i>
                            На сайте с {{ profile_user.created_at|date:"d.m.Y" }}
                        </small>
                    </div>
                </div>
            </div>

            <!-- Последние отзывы -->
            {% if recent_reviews %}
            <!-- Removed glass-card class, using card with inline styles -->
            <div class="card mt-4" style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg);">
                <div class="card-header" style="background: transparent; border-bottom: 1px solid var(--border-color);">
                    <h5 class="mb-0" style="color: var(--text-primary);">
                        </i>Последние отзывы
                    </h5>
                </div>
                <div class="card-body">
                    {% for review in recent_reviews %}
                    <div class="p-3 mb-3 rounded" style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-color);">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <a href="{% url 'space_detail' review.space.pk %}"
                               class="text-decoration-none fw-bold gold-text">
                                {{ review.space.title }}
                            </a>
                            <span class="gold-text">
                                {% for i in "12345" %}
                                <i class="{% if forloop.counter <= review.rating %}fas{% else %}far{% endif %} fa-star"></i>
                                {% endfor %}
                            </span>
                        </div>
                        <p class="mb-2" style="color: var(--text-secondary);">{{ review.comment|truncatechars:150 }}</p>
                        <small style="color: var(--text-muted);">{{ review.created_at|date:"d.m.Y" }}</small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Кнопка назад -->
            <div class="mt-4 text-center">
                <a href="javascript:history.back()" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Назад
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
